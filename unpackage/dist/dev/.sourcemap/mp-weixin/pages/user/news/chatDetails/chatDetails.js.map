{"version":3,"sources":["uni-app:///main.js","webpack:///D:/微信小程序项目/lab/pages/user/news/chatDetails/chatDetails.vue?53cf","webpack:///D:/微信小程序项目/lab/pages/user/news/chatDetails/chatDetails.vue?64f9","webpack:///D:/微信小程序项目/lab/pages/user/news/chatDetails/chatDetails.vue?56d7","webpack:///D:/微信小程序项目/lab/pages/user/news/chatDetails/chatDetails.vue?5271","uni-app:///pages/user/news/chatDetails/chatDetails.vue","webpack:///D:/微信小程序项目/lab/pages/user/news/chatDetails/chatDetails.vue?af4c"],"names":["wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page","renderjs","component","options","__file","components","uniIcons","e","message","indexOf","console","error","render","_vm","this","_h","$createElement","g0","_self","_c","messages","length","$mp","data","Object","assign","$root","recyclableRender","staticRenderFns","_withStripped","img","img2","tousername","username","textMessage","socketTask","socketOpen","socketOpening","socketMsgQueue","send","onLoad","onShow","onUnload","methods","changeSend","closeSocket","success","that","fail","clickRequest","connectSocketInit","url"],"mappings":"kKAAA,MAGA,aACA,YAFAA,EAAGC,kCAAoCC,EAGvCC,EAAWC,a,gFCLX,oIACIC,EADJ,QASIC,EAAY,qBACd,aACA,YACA,sBACA,EACA,KACA,KACA,MACA,EACA,gBACAD,GAGFC,EAAUC,QAAQC,OAAS,8CACZ,aAAAF,E,0CCvBf,uQ,iCCAA,IAAIG,EAAJ,0LACA,IACEA,EAAa,CACXC,SAAU,WACR,OAAO,yHAKX,MAAOC,GACP,IAC+C,IAA7CA,EAAEC,QAAQC,QAAQ,wBACa,IAA/BF,EAAEC,QAAQC,QAAQ,QAWlB,MAAMF,EATNG,QAAQC,MAAMJ,EAAEC,SAChBE,QAAQC,MAAM,mBACdD,QAAQC,MACN,uFAEFD,QAAQC,MACN,mDAMN,IAAIC,EAAS,WACX,IAAIC,EAAMC,KACNC,EAAKF,EAAIG,eAETC,GADKJ,EAAIK,MAAMC,GACVN,EAAIO,SAASC,QACtBR,EAAIS,IAAIC,KAAOC,OAAOC,OACpB,GACA,CACEC,MAAO,CACLT,GAAIA,MAKRU,GAAmB,EACnBC,EAAkB,GACtBhB,EAAOiB,eAAgB,G,iCC1CvB,yHAAspB,eAAG,G,qJCsCzpB,W,EACA,CACAN,gBACA,OACAO,OACAC,QACAC,cACAC,YACAC,eACAC,gBACAC,cACAC,iBACAC,kBACAlB,UACA,CACAZ,WACAyB,YACAD,gBAGAO,UAGAC,mBACA9B,eACA,6BACA,yBACAA,kCACAA,uCAEA+B,kBACA/B,sBACA,+DAEAgC,oBACAhC,wBACA,oBAEAiC,SACAC,sBACA,iBACA,aAEA,cAIAC,uBACAnC,oBACA,WACA,uBACAoC,oBACAC,gBACArC,uBAEAsC,iBACAtC,0BAKAuC,wBAAA,WACA,oBACA,OACA,yBACA,uBACA,oBAEAvC,eACA,sBACAa,uBACAuB,mBAAA,yHACApC,sBAAA,0CADA,MAIA,uCACA,wBACA,+BAEAA,oBACAA,sCAKA4B,mCAIAY,6BAAA,WACA,sBACA,iCACAC,wFACAL,mBACApC,8DAGA,oCACAA,oCACA,gBACA,mBACA,mBACAa,cACAuB,mBAAA,yHACApC,sBAAA,0CADA,SAKA,uCACA,0BACA,yBACA,2BACAA,sBACAA,wBACA,qBACAA,sBACA,iBACA,eACA,wCACA,yCAEAA,iCAEA,oCACAA,4BAIA,c,6DCtKA,yHAAytC,eAAG,G","file":"pages/user/news/chatDetails/chatDetails.js","sourcesContent":["import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './pages/user/news/chatDetails/chatDetails.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./chatDetails.vue?vue&type=template&id=3a4ff9e4&\"\nvar renderjs\nimport script from \"./chatDetails.vue?vue&type=script&lang=js&\"\nexport * from \"./chatDetails.vue?vue&type=script&lang=js&\"\nimport style0 from \"./chatDetails.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/user/news/chatDetails/chatDetails.vue\"\nexport default component.exports","export * from \"-!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--17-0!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatDetails.vue?vue&type=template&id=3a4ff9e4&\"","var components\ntry {\n  components = {\n    uniIcons: function () {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-icons/components/uni-icons/uni-icons\" */ \"@/uni_modules/uni-icons/components/uni-icons/uni-icons.vue\"\n      )\n    },\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function () {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.messages.length\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n      },\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatDetails.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/babel-loader/lib/index.js!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--13-1!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatDetails.vue?vue&type=script&lang=js&\"","<template>\n  <view>\r\n    <div class=\"top\">\r\n      <text>{{tousername}}</text>\r\n      <div class=\"uniIcon\">\r\n        <uni-icons color='' type=\"more-filled\" size=\"15\"></uni-icons>\r\n      </div>\r\n    </div>\r\n    <!-- body -->\r\n    <div class=\"body _myTheme\">\r\n      <template v-for=\"(item,i) in messages\">\r\n        <div :class=\"{'new2': item.username === username , 'new': true }\" :key=\"item.id\" v-if=\"messages.length!=0\">\r\n            <view class=\"user\">\r\n              <image :src=\"item.username === username ? img2 : img\" mode=\"aspectFill\"></image>\r\n            </view>\r\n          <text class=\"_myTheme1\">{{item.message}}</text>\r\n        </div>\r\n      </template>\r\n    </div>\r\n    <!-- body -->\r\n    <div class=\"enter _myTheme1\">\r\n      <div class=\"uniIcon\">\r\n        <uni-icons color=''  type=\"mic\" size=\"28\"></uni-icons>\r\n      </div>\r\n      <input class=\"_myTheme\" type=\"text\" v-model=\"textMessage\" @input=\"changeSend\" v-if=\"!send\" focus=\"true\">\r\n      <input class=\"_myTheme another\" type=\"text\" v-model=\"textMessage\" @input=\"changeSend\" v-else focus=\"true\">\r\n      <div class=\"uniIcon\">\r\n        <uni-icons color='' type=\"heart\" size=\"28\"></uni-icons>\r\n      </div>\r\n      <div class=\"uniIcon\" v-if=\"!send\">\r\n        <uni-icons color='' type=\"plus\" size=\"28\"></uni-icons>\r\n      </div>\r\n      <div class=\"deliver\" v-else @click=\"clickRequest\">发送</div>\r\n    </div>\n  </view>\n</template>\n\n<script>\r\n  import config from '@/utils/config.js'\n  export default {\n    data() {\n      return {\r\n        img:'',\r\n        img2:'',\r\n        tousername: '',\r\n        username: '',\r\n        textMessage:'',\n        socketTask: null,\r\n        socketOpen: false,\r\n        socketOpening: false,\r\n        socketMsgQueue: [],\r\n        messages:[\r\n          {\r\n            message:'',\r\n            username:'',\r\n            tousername:''\r\n          }\r\n        ],\r\n        send:false,\n      };\n    },\r\n    onLoad(options){\r\n      console.log(options);\r\n      this.tousername = options.tousername\r\n      this.username = options.username\r\n      console.log(this.username+'user');\r\n      console.log(this.tousername+'touser');\r\n    },\r\n    onShow(){\r\n      console.log('onshow');\r\n      if (!this.socketOpening && !this.socketOpen) this.connectSocketInit() // 防止 安卓返回桌面超过10s，回到聊天页面websocket自动断开\r\n    },\r\n    onUnload(){\r\n      console.log('onUnload');\r\n      this.closeSocket()\r\n    },\r\n    methods:{\r\n      changeSend(){\r\n        if(this.textMessage){\r\n          this.send=true\r\n        } else{\r\n          this.send=false\r\n        }\r\n      },\r\n      //关闭webSocket\r\n      closeSocket() {\r\n        console.log('调用成功');\r\n        const that = this\r\n        this.socketTask.close({\r\n          success(res) {\r\n            that.socketOpen = false;\r\n            console.log(\"关闭成功\", res)\r\n          },\r\n          fail(err) {\r\n            console.log(\"关闭失败\", err)\r\n          }\r\n        })\r\n      },\r\n      //发送信息\r\n      clickRequest(){\r\n        if (this.socketOpen) {\r\n          let text={\r\n            \"message\":this.textMessage,\r\n            \"username\":this.username,\r\n            \"to\":this.tousername\r\n          };\r\n          console.log(text);\r\n          this.socketTask.send({\r\n            data:JSON.stringify(text),\r\n            async success() {\r\n              console.log(\"消息发送成功\");\r\n            },\r\n          });\r\n          this.socketTask.onMessage((res) => {\r\n            if(res.data.charAt(3)=='c'){\r\n              this.messages=JSON.parse(res.data)\r\n            }\r\n            console.log(res.data);\r\n            console.log(res.data.charAt(3));\r\n          });\r\n        } \r\n        else \r\n        {\r\n          socketMsgQueue.push(this.message);\r\n        }\r\n      },\r\n      // 开启 WebSocket 连接。\r\n      connectSocketInit(){\r\n        this.socketOpening = true,\r\n        this.socketTask = uni.connectSocket({ \r\n        \turl: config.WebSocket+`/websocket/${this.username}/${this.tousername}`,\r\n          success:()=>{\r\n            console.log('this.socketTask = uni.connectSocket success');\r\n          }\r\n        });\r\n        this.socketTask.onOpen((res) => {\r\n          console.log(\"WebSocket连接正常打开中...！\");\r\n          this.socketOpen = true;\r\n          this.socketOpening = false,\r\n          this.socketTask.send({\r\n            data: \"发送一条消息\",\r\n            async success() {\r\n              console.log(\"消息发送成功\");\r\n            },\r\n          });\r\n        })\r\n        this.socketTask.onMessage((res) => {\r\n          if(res.data.charAt(3)=='o'){\r\n            let mess = JSON.parse(res.data)\r\n            this.messages= mess.data.messages\r\n            console.log('888888');\r\n            console.log(this.messages);\r\n            let hashmap = mess.data.hashmap\r\n            console.log('999999');\r\n            let img =this.username\r\n            let img2 = this.tousername\r\n            this.img='http://106.54.177.78:9112/'+hashmap[img]\r\n            this.img2='http://106.54.177.78:9112/'+hashmap[img2]\r\n          }\r\n          console.log(res.data.charAt(3));\r\n        });\r\n        this.socketTask.onClose(() => {\r\n          console.log(\"已经被关闭了\")\r\n        })\r\n      }\r\n    }\r\n  }\n</script>\n\n<style lang=\"scss\">\nview{\r\n  .top{\r\n    width: 100%;\r\n    height: 100rpx;\r\n    text-align: center;\r\n    line-height: 100rpx;\r\n    border-bottom: 1rpx solid #e5e5e5;\r\n    text{\r\n      font-weight: 550;\r\n    }\r\n    .uniIcon{\r\n      float: right;\r\n      padding-left: 20rpx;\r\n      padding-right: 20rpx;\r\n    }\r\n  }\r\n  .body{\r\n    overflow-y: scroll;\r\n    width: 100%;\r\n    height: 80vh;\r\n    padding-top: 10rpx;\r\n    background-color: #ededed;\r\n    .new, .new2{\r\n      float: left;\r\n      width: 100%;\r\n      box-sizing: border-box;\r\n      padding: 25rpx;\r\n      .user{\r\n        float: left;\r\n        width: 90rpx;\r\n        height: 90rpx;\r\n        margin-right: 20rpx;\r\n        box-sizing: border-box;\r\n        display: flex;\r\n        justify-content: center;\r\n        align-items: center;\r\n        overflow: hidden;\r\n        box-shadow: 0 0 2rpx 2rpx white;\r\n        border-radius: 50rpx;\r\n        image{\r\n          height: 100%;\r\n          width: 100%;\r\n        }\r\n      }\r\n      text{\r\n        float: left;\r\n        line-height: 60rpx;\r\n        padding: 15rpx;\r\n        max-width: 530rpx;\r\n        min-height: 60rpx;\r\n        border-radius: 10rpx;\r\n      }\r\n    }\r\n    .new2{\r\n      float: right !important;\r\n      .user{\r\n        float: right !important;\r\n        image{\r\n        }\r\n      }\r\n      text{\r\n        float: right !important;\r\n      }\r\n    }\r\n  }\r\n  .enter{\r\n    position: fixed;\r\n    bottom: 0;\r\n    width: 100%;\r\n    height: 10vh;\r\n    .uniIcon{\r\n      float: left;\r\n      padding: 5rpx;\r\n      padding-top: 30rpx;\r\n    }\r\n    .deliver{\r\n      float: right;\r\n      width: 120rpx;\r\n      height: 60rpx;\r\n      margin-top: 25rpx;\r\n      margin-right: 10rpx;\r\n      color: white;\r\n      text-align: center;\r\n      line-height: 60rpx;\r\n      font-size: 30rpx;\r\n      background-color: #07c160;\r\n      border-radius: 10rpx;\r\n    }\r\n    input{\r\n      float: left;\r\n      width: 520rpx;\r\n      height: 70rpx;\r\n      padding-left: 20rpx;\r\n      margin-top: 20rpx;\r\n      // background-color: white;\r\n    }\r\n    .another{\r\n      width: 460rpx;\r\n    }\r\n  }\r\n}\n</style>\n","import mod from \"-!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatDetails.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-2!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-3!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader/index.js??ref--8-oneOf-1-5!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/index.js??vue-loader-options!../../../../../../HBuilderX/plugins/uniapp-cli/node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./chatDetails.vue?vue&type=style&index=0&lang=scss&\""],"sourceRoot":""}